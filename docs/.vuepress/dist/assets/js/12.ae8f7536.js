(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{492:function(t,a,s){"use strict";s.r(a);var e=s(4),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"导语"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#导语"}},[t._v("#")]),t._v(" 导语")]),t._v(" "),s("p",[t._v("在开发过程中，经常需要打包给QA进行测试。这种重复性高的工作，我通过脚本的方式实现。让QA在配置好的电脑上面执行脚本，即可实现打包测试。美滋滋！")]),t._v(" "),s("h2",{attrs:{id:"项目背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目背景"}},[t._v("#")]),t._v(" 项目背景")]),t._v(" "),s("h4",{attrs:{id:"mac"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mac"}},[t._v("#")]),t._v(" Mac")]),t._v(" "),s("p",[t._v("项目跟脚本都是在Mac系统上执行的；")]),t._v(" "),s("h4",{attrs:{id:"bash"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bash"}},[t._v("#")]),t._v(" bash")]),t._v(" "),s("p",[t._v("脚本语言使用的是bash，所以需要电脑支持bash脚本的执行。Mac系统默认支持！")]),t._v(" "),s("h4",{attrs:{id:"react-native"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#react-native"}},[t._v("#")]),t._v(" React-Native")]),t._v(" "),s("p",[t._v("项目是使用 React-Native 框架开发的，所以脚本中有部分代码是针对 RN 的；")]),t._v(" "),s("h2",{attrs:{id:"打包前准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#打包前准备"}},[t._v("#")]),t._v(" 打包前准备")]),t._v(" "),s("h4",{attrs:{id:"配置证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置证书"}},[t._v("#")]),t._v(" 配置证书")]),t._v(" "),s("h4",{attrs:{id:"项目编译成功"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目编译成功"}},[t._v("#")]),t._v(" 项目编译成功")]),t._v(" "),s("h4",{attrs:{id:"蒲公英生成应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#蒲公英生成应用"}},[t._v("#")]),t._v(" 蒲公英生成应用")]),t._v(" "),s("h2",{attrs:{id:"打包流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#打包流程"}},[t._v("#")]),t._v(" 打包流程")]),t._v(" "),s("h4",{attrs:{id:"生成-exportoptions-plist-文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生成-exportoptions-plist-文件"}},[t._v("#")]),t._v(" 生成 exportOptions plist 文件")]),t._v(" "),s("p",[t._v("exportOptions配置文件为使用xcode导包的配置项；")]),t._v(" "),s("p",[t._v("配置项说明：")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("provisioningProfiles")]),t._v(" App bundle ID 为key，mobileprovision 的文件名作为 value；")]),t._v(" "),s("li",[s("code",[t._v("method")]),t._v(" 决定导出包的类型，包括：app-store、ad-hoc、package、enterprise、development、developer-id、and mac-application；")]),t._v(" "),s("li",[s("code",[t._v("teamID")]),t._v(" 开发者ID，可在 keychain 或者登录开发者网站中查看；")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/7/6/16bc7d2433ee5123?w=1992&h=1520&f=jpeg&s=277802",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"更新代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更新代码"}},[t._v("#")]),t._v(" 更新代码")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" pull\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("link")]),t._v("\n")])])]),s("h4",{attrs:{id:"清除缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#清除缓存"}},[t._v("#")]),t._v(" 清除缓存")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用 Cocoapods")]),t._v("\nxcodebuild clean -workspace "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("workspace_path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  -scheme "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_scheme"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -configuration "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Debug Or Release"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 不使用 Cocoapods")]),t._v("\nxcodebuild clean -project "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("project_path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  -scheme "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_scheme"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -configuration "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Debug Or Release"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("p",[t._v("代码说明：")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("<workspace_path>")]),t._v(" 项目.xcworkspace的绝对路径；")]),t._v(" "),s("li",[s("code",[t._v("<project_path>")]),t._v(" 项目.xcodeproj的绝对路径；")]),t._v(" "),s("li",[s("code",[t._v("<app_scheme>")]),t._v(" 项目App的scheme (非Extension App)；")]),t._v(" "),s("li",[s("code",[t._v("<Debug Or Release>")]),t._v(" 编译环境，Debug Or Release；")])]),t._v(" "),s("p",[t._v("App的scheme必须跟项目中 Manager Schemes 中的 Scheme name 一致；")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2019/7/6/16bc7d7d0d97d297?w=3256&h=2204&f=png&s=1284315",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"开始编译"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开始编译"}},[t._v("#")]),t._v(" 开始编译")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用 Cocoapods")]),t._v("\nxcodebuild archive -workspace "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("workspace_path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -scheme "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_scheme"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -archivePath "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("xcarchive_path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 不使用 Cocoapods")]),t._v("\nxcodebuild archive -project "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("project_path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -scheme "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_scheme"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -archivePath "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("xcarchive_path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("p",[t._v("代码说明：")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("<workspace_path>")]),t._v(" 同上；")]),t._v(" "),s("li",[s("code",[t._v("<project_path>")]),t._v(" 同上；")]),t._v(" "),s("li",[s("code",[t._v("<app_scheme>")]),t._v(" 同上；")]),t._v(" "),s("li",[s("code",[t._v("<xcarchive_path>")]),t._v(" 导出 achive 文件路径；")])]),t._v(" "),s("h4",{attrs:{id:"导出-ipa-包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#导出-ipa-包"}},[t._v("#")]),t._v(" 导出 ipa 包")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("xcodebuild -exportArchive -archivePath "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("xcarchive_path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -exportPath "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("export_ipa_path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -exportOptionsPlist "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("exportOptionsPlist_path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("p",[t._v("代码说明：")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("<xcarchive_path>")]),t._v(" achive文件路径；")]),t._v(" "),s("li",[s("code",[t._v("<export_ipa_path>")]),t._v(" ipa文件导出路径；")]),t._v(" "),s("li",[s("code",[t._v("<exportOptionsPlist_path>")]),t._v(" 导包配置plist文件；")])]),t._v(" "),s("h4",{attrs:{id:"上传到蒲公英"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#上传到蒲公英"}},[t._v("#")]),t._v(" 上传到蒲公英")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -F "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"file=@{'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$filePath")]),t._v('}"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-F "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"uKey={'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uKey")]),t._v('}"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-F "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_api_key={'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$apiKey")]),t._v('}"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nhttps://www.pgyer.com/apiv1/app/upload\n")])])]),s("p",[t._v("代码说明：")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("{$filePath}")]),t._v(" 是应用安装包文件的路径；")]),t._v(" "),s("li",[s("code",[t._v("{$uKey}")]),t._v(" 是开发者的用户 Key，在应用管理-API中查看；")]),t._v(" "),s("li",[s("code",[t._v("{$apiKey}")]),t._v(" 是开发者的 API Key，在应用管理-API中查看；")])]),t._v(" "),s("p",[t._v("如果上传成功，接口会以 JSON 格式返回应用的详细信息。如果上传失败，则会返回相应的错误信息。")]),t._v(" "),s("h2",{attrs:{id:"完整代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#完整代码"}},[t._v("#")]),t._v(" 完整代码")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/sh")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# echo "\\033[42;37m ~~~~~~~~~~~~~~~~ 开始执行脚本 ~~~~~~~~~~~~~~~~ \\033[0m" ')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#------------------------- 脚本配置信息 --------------------------------------------")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 工程目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BASE_PROJECT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 工程名称")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PROJECT_NAME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 编译模式，默认有 Debug Release")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CONFIGURATION_TARGET")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Release\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 编译路径")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BUILDPATH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("~/Desktop\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 导出ipa 所需plist")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ADHOCExportOptionsPlist")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("~/exportOptions.plist\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# archivePath")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ARCHIVEPATH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${BUILDPATH}")]),t._v("/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${PROJECT_NAME}")]),t._v("/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${PROJECT_NAME}")]),t._v(".xcarchive\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ipa 存放路径")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("IPAPATH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${BUILDPATH}")]),t._v("/ipa_"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),t._v(" +%F-%T"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 蒲公英 key")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("uKey")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 蒲公英 apiKey")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("apiKey")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 蒲公英下载地址")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DOWNLOAD_PATH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# #------------------------- 判断文件/目录是否存在 --------------------------------------------")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" -d "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${BASE_PROJECT}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v("[31m "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${BASE_PROJECT}")]),t._v(" 路径不存在，请检查! "),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v('[0m"')]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("elif")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" -d "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${BASE_PROJECT}")]),t._v("/ios "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v("[31m "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${BASE_PROJECT}")]),t._v("/ios 路径不存在，请检查! "),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v('[0m"')]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("elif")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" -f "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${ADHOCExportOptionsPlist}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v("[31m"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${ADHOCExportOptionsPlist}")]),t._v(" 文件不存在，请检查! "),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v('[0m"')]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#------------------------- 判断证书是否正确设置 --------------------------------------------")]),t._v("\n\n\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v("[42;37m ~~~~~~~~~~~~~~~~ 更新代码 ~~~~~~~~~~~~~~~~ "),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v('[0m"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${BASE_PROJECT}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# git checkout dev")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# git pull origin dev")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# npm install")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# react-native link")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v("[42;37m ~~~~~~~~~~~~~~~~ 清除缓存 ~~~~~~~~~~~~~~~~ "),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v('[0m"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ./ios\nwatchman watch-del-all\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# npm start -- --reset-cache")]),t._v("\nxcodebuild clean -project "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${PROJECT_NAME}")]),t._v(".xcodeproj -scheme "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${PROJECT_NAME}")]),t._v(" -configuration "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${CONFIGURATION_TARGET}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v("[42;37m ~~~~~~~~~~~~~~~~ 开始编译 ~~~~~~~~~~~~~~~~ "),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v('[0m"')]),t._v("\n\nxcodebuild archive -project "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${PROJECT_NAME}")]),t._v(".xcodeproj -scheme "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${PROJECT_NAME}")]),t._v(" -archivePath "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${ARCHIVEPATH}")]),t._v(" -configuration "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${CONFIGURATION_TARGET}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#------------------------- 判断编辑是否成功 --------------------------------------------")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" -d "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ARCHIVEPATH")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v("[31m 编译失败! "),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v('[0m"')]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v("[42;37m ~~~~~~~~~~~~~~~~ 导出ipa ~~~~~~~~~~~~~~~~ "),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v('[0m"')]),t._v("\n\nxcodebuild -exportArchive -archivePath "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${ARCHIVEPATH}")]),t._v(" -exportPath "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${IPAPATH}")]),t._v(" -exportOptionsPlist "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${ADHOCExportOptionsPlist}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#------------------------- 判断导出是否成功 --------------------------------------------")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" -d "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$IPAPATH")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v("[31m 导出ipa失败! "),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v('[0m"')]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v("[42;37m ~~~~~~~~~~~~~~~~ 上传到蒲公英 ~~~~~~~~~~~~~~~~ "),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v('[0m"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -F "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"file=@'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$IPAPATH")]),t._v("/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${PROJECT_NAME}")]),t._v('.ipa"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-F "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"uKey='),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uKey")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-F "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_api_key='),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$apiKey")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nhttp://www.pgyer.com/apiv1/app/upload\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#------------------------- 浏览器打开下载地址 --------------------------------------------")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),t._v(" -a "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/Applications/Safari.app"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${DOWNLOAD_PATH}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v("[42;37m ~~~~~~~~~~~~~~~~ 打包成功 ~~~~~~~~~~~~~~~~ "),s("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[t._v("\\033")]),t._v('[0m"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])]),s("h2",{attrs:{id:"打包过程遇到的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#打包过程遇到的问题"}},[t._v("#")]),t._v(" 打包过程遇到的问题")]),t._v(" "),s("h4",{attrs:{id:"执行脚本报错：permission-denied"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#执行脚本报错：permission-denied"}},[t._v("#")]),t._v(" 执行脚本报错：Permission denied")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 解决方法：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("777")]),t._v(" 文件路径\n")])])]),s("h2",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),s("blockquote",[s("ol",[s("li",[s("a",{attrs:{href:"https://www.jianshu.com/p/36d67d7d6985",target:"_blank",rel:"noopener noreferrer"}},[t._v("Xcode命令行脚本打包；"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.pgyer.com/doc/view/upload_one_command",target:"_blank",rel:"noopener noreferrer"}},[t._v("蒲公英：使用一条命令快速上传应用；"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://developer.apple.com/library/archive/technotes/tn2339/_index.html#//apple_ref/doc/uid/DTS40014588-CH1-WHAT_IS_THE_COMMAND_LINE_TOOLS_PACKAGE_",target:"_blank",rel:"noopener noreferrer"}},[t._v("Building from the Command Line with Xcode FAQ"),s("OutboundLink")],1)])])])])}),[],!1,null,null,null);a.default=n.exports}}]);